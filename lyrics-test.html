<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­Œè¯æœç´¢æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056CC;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        .error {
            color: #FF3B30;
            background: #FFE5E5;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .success {
            color: #34C759;
            background: #E5F7E5;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .info {
            color: #007AFF;
            background: #E5F2FF;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .lyrics-display {
            max-height: 400px;
            overflow-y: auto;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .song-info {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .song-info h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .song-info div {
            margin: 5px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ æ­Œè¯æœç´¢åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. æœç´¢æ­Œæ›²ID</h3>
            <div class="input-group">
                <label>æ­Œæ›²åç§°:</label>
                <input type="text" id="search-song-name" placeholder="ä¾‹å¦‚: æ™®é€šæœ‹å‹" value="æ™®é€šæœ‹å‹">
            </div>
            <div class="input-group">
                <label>è‰ºæœ¯å®¶ (å¯é€‰):</label>
                <input type="text" id="search-artist" placeholder="ä¾‹å¦‚: é™¶å–†" value="é™¶å–†">
            </div>
            <button class="btn" onclick="testSearchSong()">æœç´¢æ­Œæ›²</button>
            <div id="search-results"></div>
        </div>
        
        <div class="test-section">
            <h3>2. è·å–æ­Œè¯</h3>
            <div class="input-group">
                <label>æ­Œæ›²ID:</label>
                <input type="text" id="lyrics-song-id" placeholder="ä»ä¸Šé¢æœç´¢è·å¾—çš„ID" value="150623">
            </div>
            <button class="btn" onclick="testFetchLyrics()">è·å–æ­Œè¯</button>
            <div id="lyrics-results"></div>
        </div>
        
        <div class="test-section">
            <h3>3. è‡ªåŠ¨æœç´¢æ­Œè¯ (ç»„åˆåŠŸèƒ½)</h3>
            <div class="input-group">
                <label>æ­Œæ›²åç§°:</label>
                <input type="text" id="auto-song-name" placeholder="ä¾‹å¦‚: æ™®é€šæœ‹å‹" value="æ™®é€šæœ‹å‹">
            </div>
            <div class="input-group">
                <label>è‰ºæœ¯å®¶ (å¯é€‰):</label>
                <input type="text" id="auto-artist" placeholder="ä¾‹å¦‚: é™¶å–†" value="é™¶å–†">
            </div>
            <button class="btn" onclick="testAutoSearch()">è‡ªåŠ¨æœç´¢æ­Œè¯</button>
            <div id="auto-results"></div>
        </div>
    </div>

    <script>
        async function testSearchSong() {
            const songName = document.getElementById('search-song-name').value;
            const artist = document.getElementById('search-artist').value;
            const resultsDiv = document.getElementById('search-results');
            
            if (!songName) {
                showError(resultsDiv, 'è¯·è¾“å…¥æ­Œæ›²åç§°');
                return;
            }
            
            try {
                showInfo(resultsDiv, 'æ­£åœ¨æœç´¢æ­Œæ›²...');
                
                if (!window.electronAPI) {
                    showError(resultsDiv, 'éœ€è¦åœ¨ Electron ç¯å¢ƒä¸­è¿è¡Œ');
                    return;
                }
                
                const result = await window.electronAPI.searchSongId(songName, artist);
                
                if (result.success) {
                    let output = '<div class="success">æœç´¢æˆåŠŸ!</div>';
                    output += '<div class="song-info">';
                    output += `<h4>æ‰¾åˆ°æ­Œæ›²:</h4>`;
                    output += `<div><strong>ID:</strong> ${result.songId}</div>`;
                    output += `<div><strong>åç§°:</strong> ${result.songName}</div>`;
                    output += `<div><strong>è‰ºæœ¯å®¶:</strong> ${result.artistName}</div>`;
                    output += `<div><strong>ä¸“è¾‘:</strong> ${result.albumName}</div>`;
                    output += `<div><strong>æ—¶é•¿:</strong> ${Math.floor(result.duration / 1000 / 60)}:${String(Math.floor(result.duration / 1000 % 60)).padStart(2, '0')}</div>`;
                    output += '</div>';
                    
                    // è‡ªåŠ¨å¡«å……åˆ°æ­Œè¯æœç´¢æ¡†
                    document.getElementById('lyrics-song-id').value = result.songId;
                    
                    resultsDiv.innerHTML = output;
                } else {
                    showError(resultsDiv, `æœç´¢å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                showError(resultsDiv, `æœç´¢å‡ºé”™: ${error.message}`);
            }
        }
        
        async function testFetchLyrics() {
            const songId = document.getElementById('lyrics-song-id').value;
            const resultsDiv = document.getElementById('lyrics-results');
            
            if (!songId) {
                showError(resultsDiv, 'è¯·è¾“å…¥æ­Œæ›²ID');
                return;
            }
            
            try {
                showInfo(resultsDiv, 'æ­£åœ¨è·å–æ­Œè¯...');
                
                if (!window.electronAPI) {
                    showError(resultsDiv, 'éœ€è¦åœ¨ Electron ç¯å¢ƒä¸­è¿è¡Œ');
                    return;
                }
                
                const result = await window.electronAPI.fetchLyrics(songId);
                
                if (result.success) {
                    let output = '<div class="success">æ­Œè¯è·å–æˆåŠŸ!</div>';
                    
                    if (result.lyrics) {
                        output += '<h4>æ­Œè¯å†…å®¹:</h4>';
                        output += `<div class="lyrics-display">${result.lyrics}</div>`;
                    }
                    
                    if (result.translatedLyrics) {
                        output += '<h4>ç¿»è¯‘æ­Œè¯:</h4>';
                        output += `<div class="lyrics-display">${result.translatedLyrics}</div>`;
                    }
                    
                    resultsDiv.innerHTML = output;
                } else {
                    showError(resultsDiv, `è·å–æ­Œè¯å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                showError(resultsDiv, `è·å–å‡ºé”™: ${error.message}`);
            }
        }
        
        async function testAutoSearch() {
            const songName = document.getElementById('auto-song-name').value;
            const artist = document.getElementById('auto-artist').value;
            const resultsDiv = document.getElementById('auto-results');
            
            if (!songName) {
                showError(resultsDiv, 'è¯·è¾“å…¥æ­Œæ›²åç§°');
                return;
            }
            
            try {
                showInfo(resultsDiv, 'æ­£åœ¨è‡ªåŠ¨æœç´¢æ­Œè¯...');
                
                if (!window.electronAPI) {
                    showError(resultsDiv, 'éœ€è¦åœ¨ Electron ç¯å¢ƒä¸­è¿è¡Œ');
                    return;
                }
                
                const result = await window.electronAPI.autoSearchLyrics(songName, artist);
                
                if (result.success) {
                    let output = '<div class="success">è‡ªåŠ¨æœç´¢æˆåŠŸ!</div>';
                    
                    // æ˜¾ç¤ºæ­Œæ›²ä¿¡æ¯
                    output += '<div class="song-info">';
                    output += `<h4>æ­Œæ›²ä¿¡æ¯:</h4>`;
                    output += `<div><strong>ID:</strong> ${result.songInfo.id}</div>`;
                    output += `<div><strong>åç§°:</strong> ${result.songInfo.name}</div>`;
                    output += `<div><strong>è‰ºæœ¯å®¶:</strong> ${result.songInfo.artist}</div>`;
                    output += `<div><strong>ä¸“è¾‘:</strong> ${result.songInfo.album}</div>`;
                    output += '</div>';
                    
                    // æ˜¾ç¤ºæ­Œè¯
                    if (result.lyrics) {
                        output += '<h4>æ­Œè¯å†…å®¹:</h4>';
                        output += `<div class="lyrics-display">${result.lyrics}</div>`;
                    }
                    
                    if (result.translatedLyrics) {
                        output += '<h4>ç¿»è¯‘æ­Œè¯:</h4>';
                        output += `<div class="lyrics-display">${result.translatedLyrics}</div>`;
                    }
                    
                    resultsDiv.innerHTML = output;
                } else {
                    showError(resultsDiv, `è‡ªåŠ¨æœç´¢å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                showError(resultsDiv, `æœç´¢å‡ºé”™: ${error.message}`);
            }
        }
        
        function showError(element, message) {
            element.innerHTML = `<div class="error">âŒ ${message}</div>`;
        }
        
        function showSuccess(element, message) {
            element.innerHTML = `<div class="success">âœ… ${message}</div>`;
        }
        
        function showInfo(element, message) {
            element.innerHTML = `<div class="info">â„¹ï¸ ${message}</div>`;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        document.addEventListener('DOMContentLoaded', function() {
            if (!window.electronAPI) {
                document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><div style="color: red; font-size: 18px;">âŒ æ­¤æµ‹è¯•é¡µé¢éœ€è¦åœ¨ MyMusic åº”ç”¨ä¸­è¿è¡Œ</div><p>è¯·åœ¨ MyMusic ä¸»åº”ç”¨ä¸­æ‰“å¼€æ­¤é¡µé¢è¿›è¡Œæµ‹è¯•</p></div>';
            } else {
                console.log('âœ… Electron API å¯ç”¨ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•');
            }
        });
    </script>
</body>
</html>