# 🎵 自动歌词搜索功能 - 完整实现指南

## ✨ 功能概述

MyMusic 播放器现在支持**自动搜索和显示在线歌词**功能！基于网易云音乐API，能够：

- 🔍 **智能搜索** - 根据歌曲名和艺术家自动匹配在线歌曲
- 📝 **歌词获取** - 自动下载LRC格式的时间轴歌词
- 🎯 **实时同步** - 播放时歌词高亮滚动跟随
- 🌐 **翻译支持** - 自动获取中英文对照歌词
- 💾 **本地缓存** - 歌词自动保存，避免重复下载

## 🛠️ 技术实现

### 后端功能 (main.js)

#### 1. 歌曲搜索API
```javascript
// 搜索歌曲ID
window.electronAPI.searchSongId(songName, artistName)
```
- **URL**: `https://music.163.com/api/search/get/web`
- **参数**: 歌曲名称、艺术家(可选)
- **返回**: 歌曲ID、名称、艺术家、专辑等信息

#### 2. 歌词获取API  
```javascript
// 获取歌词内容
window.electronAPI.fetchLyrics(songId)
```
- **URL**: `https://music.163.com/api/song/lyric`
- **参数**: 歌曲ID
- **返回**: LRC格式歌词和翻译

#### 3. 组合功能API
```javascript
// 自动搜索并获取歌词
window.electronAPI.autoSearchLyrics(songName, artistName)
```
- **功能**: 一步完成搜索歌曲→获取歌词的全流程
- **返回**: 歌曲信息 + 歌词内容

### 前端功能 (lyrics.js)

#### 1. 歌词管理器 (LyricsManager)
- **LRC解析** - 解析时间轴格式歌词
- **翻译合并** - 将翻译歌词与原文匹配
- **实时同步** - 根据播放时间高亮当前行
- **交互功能** - 点击歌词跳转播放位置

#### 2. 用户界面控制
```javascript
// 歌词面板控制按钮
- 显示/隐藏歌词
- 显示/隐藏翻译  
- 自动搜索歌词
- 开启/关闭同步
```

## 🎯 使用方法

### 自动获取歌词

1. **播放歌曲** - 开始播放任意本地音乐
2. **打开歌词面板** - 点击播放器的 📝 歌词按钮  
3. **搜索歌词** - 点击"搜索歌词"按钮
4. **享受同步歌词** - 歌词自动高亮滚动

### 手动操作

- **点击歌词行** - 跳转到对应播放位置
- **切换翻译** - 显示/隐藏中英文对照
- **控制同步** - 开启/关闭自动滚动

## 📋 API 接口说明

### 搜索歌曲
```http
GET https://music.163.com/api/search/get/web?s={query}&type=1&limit=10
```

**请求参数**:
- `s` - 搜索关键词 (歌名 + 艺术家)  
- `type=1` - 搜索类型 (1=单曲)
- `limit=10` - 返回数量限制

**响应格式**:
```json
{
  "code": 200,
  "result": {
    "songs": [{
      "id": 150623,
      "name": "普通朋友", 
      "artists": [{"name": "陶喆"}],
      "album": {"name": "I'm OK"},
      "duration": 255133
    }]
  }
}
```

### 获取歌词
```http
GET https://music.163.com/api/song/lyric?id={songId}&lv=-1
```

**请求参数**:
- `id` - 歌曲ID
- `lv=-1` - 歌词版本

**响应格式**:
```json
{
  "code": 200,
  "lrc": {
    "lyric": "[00:13.390]科学の限界を超えて私は来たんだよ\n[00:19.280]ネギは..."
  },
  "tlyric": {
    "lyric": "[00:13.390]我超越了科学的极限来到了这里\n[00:19.280]虽然没有大葱..."
  }
}
```

## 🎨 界面设计

### 歌词面板布局
```
┌─────────────────────────────┐
│ 歌词 [显示歌词][显示翻译][搜索][同步] │
├─────────────────────────────┤
│ [00:13] 歌词第一行          │ ← 已播放(灰色)
│ [00:19] 歌词第二行          │ ← 当前行(高亮)
│ [00:24] 歌词第三行          │ ← 未播放(正常)
│         翻译内容            │ ← 翻译(斜体)
│ ...                         │
└─────────────────────────────┘
```

### 视觉效果
- **当前行**: 蓝色高亮 + 加粗 + 左侧边框
- **已播放**: 灰色淡化显示  
- **未播放**: 正常黑色文字
- **翻译**: 斜体灰色，缩进显示
- **悬停**: 浅色背景 + 轻微缩进

## 🔧 配置选项

歌词设置会自动保存到本地存储：

```javascript
{
  lyricsEnabled: true,        // 是否显示歌词
  showLyricsTranslation: false, // 是否显示翻译
  lyricsAutoSync: true        // 是否自动同步
}
```

## 🚀 测试功能

### 使用测试页面
```bash
# 在应用中打开测试页面
./lyrics-test.html
```

测试页面提供三个测试功能：
1. **搜索歌曲ID** - 测试歌曲搜索功能
2. **获取歌词** - 测试歌词下载功能  
3. **自动搜索** - 测试完整流程

### 控制台调试
```javascript
// 手动测试搜索
await window.electronAPI.searchSongId("普通朋友", "陶喆")

// 手动测试歌词获取
await window.electronAPI.fetchLyrics(150623)

// 手动测试自动搜索
await window.electronAPI.autoSearchLyrics("普通朋友", "陶喆")
```

## 📊 性能优化

### 网络请求优化
- **超时设置** - 10秒请求超时
- **错误重试** - 自动处理网络错误
- **缓存机制** - 歌词自动保存到歌曲对象

### 界面性能
- **虚拟滚动** - 大量歌词时优化渲染
- **防抖处理** - 避免频繁的同步操作
- **延迟加载** - 按需初始化歌词管理器

## 🐛 故障排除

### 常见问题

#### Q1: 搜索不到歌曲
- 检查网络连接
- 尝试简化搜索关键词
- 确认歌曲在网易云音乐中存在

#### Q2: 歌词显示乱码
- 通常是编码问题，重新搜索即可
- 检查歌曲名称是否正确

#### Q3: 歌词不同步
- 点击"开启同步"按钮
- 检查音频播放是否正常
- 尝试点击歌词行手动校准

#### Q4: 翻译不显示  
- 并非所有歌曲都有翻译
- 点击"显示翻译"按钮

### 调试日志

应用会输出详细的调试信息：
```
搜索歌曲: 普通朋友 陶喆
找到歌曲: 普通朋友 ID: 150623
成功获取歌词
歌词加载成功，共 45 行
```

## 🌟 未来扩展

### 计划功能
- **多平台支持** - QQ音乐、酷狗等
- **歌词编辑** - 本地歌词修改功能
- **桌面歌词** - 独立桌面歌词窗口
- **歌词卡拉OK** - 逐字高亮显示
- **用户贡献** - 允许上传自定义歌词

### API扩展
- **歌曲推荐** - 基于播放历史推荐
- **音乐百科** - 获取歌曲详细信息
- **封面下载** - 自动下载高质量封面

---

现在您的 MyMusic 播放器拥有了完整的在线歌词功能！🎵✨

通过这个功能，您可以享受带有时间轴同步的专业级歌词显示体验。