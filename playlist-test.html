<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>播放列表测试页面</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        .log { background: #f5f5f5; padding: 10px; height: 200px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>播放列表功能测试</h1>
    
    <div class="test-section">
        <h3>基础测试</h3>
        <button onclick="testModulesLoaded()">检查模块加载</button>
        <button onclick="testStorage()">测试本地存储</button>
        <button onclick="testPlaylistCreation()">测试播放列表创建</button>
    </div>
    
    <div class="test-section">
        <h3>播放列表操作</h3>
        <button id="create-playlist">创建播放列表</button>
        <input type="text" id="playlist-name" placeholder="播放列表名称" value="测试播放列表">
        <button onclick="createPlaylistManually()">手动创建</button>
        <button onclick="testInputDialog()">测试输入对话框</button>
        <button onclick="testConfirmDialog()">测试确认对话框</button>
        <button onclick="testSelectDialog()">测试选择对话框</button>
    </div>
    
    <div class="test-section">
        <h3>测试日志</h3>
        <div id="log" class="log"></div>
        <button onclick="clearLog()">清除日志</button>
    </div>

    <!-- 加载必要的脚本 -->
    <script>
        // 简化的日志系统
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testModulesLoaded() {
            const modules = ['storage', 'Utils', 'playlistManager'];
            modules.forEach(module => {
                if (window[module]) {
                    log(`✓ 模块 ${module} 已加载`, 'success');
                } else {
                    log(`✗ 模块 ${module} 未加载`, 'error');
                }
            });
        }

        function testStorage() {
            try {
                localStorage.setItem('test', 'value');
                localStorage.removeItem('test');
                log('✓ localStorage 可用', 'success');
                
                if (window.storage) {
                    const playlists = window.storage.getPlaylists();
                    log(`✓ 当前播放列表数量: ${playlists.length}`, 'success');
                } else {
                    log('✗ storage 模块不可用', 'error');
                }
            } catch (error) {
                log(`✗ localStorage 错误: ${error.message}`, 'error');
            }
        }

        function testPlaylistCreation() {
            if (window.testPlaylist) {
                log('开始测试播放列表创建...', 'info');
                const result = window.testPlaylist();
                if (result) {
                    log(`✓ 播放列表创建成功: ${result.name}`, 'success');
                } else {
                    log('✗ 播放列表创建失败', 'error');
                }
            } else {
                log('✗ testPlaylist 函数不可用', 'error');
            }
        }

        function createPlaylistManually() {
            const name = document.getElementById('playlist-name').value;
            if (!name) {
                log('✗ 请输入播放列表名称', 'error');
                return;
            }

            if (window.playlistManager) {
                try {
                    log(`尝试创建播放列表: ${name}`, 'info');
                    const result = window.playlistManager.createPlaylist(name);
                    if (result) {
                        log(`✓ 播放列表创建成功: ${result.name}`, 'success');
                    } else {
                        log('✗ 播放列表创建返回 null', 'error');
                    }
                } catch (error) {
                    log(`✗ 创建播放列表时出错: ${error.message}`, 'error');
                }
            } else {
                log('✗ playlistManager 不可用', 'error');
            }
        }

        async function testInputDialog() {
            if (window.Utils && Utils.showInputDialog) {
                try {
                    const result = await Utils.showInputDialog('测试输入', '请输入一些文本', '默认值');
                    log(`输入对话框结果: ${result}`, result ? 'success' : 'info');
                } catch (error) {
                    log(`输入对话框错误: ${error.message}`, 'error');
                }
            } else {
                log('Utils.showInputDialog 不可用', 'error');
            }
        }

        async function testConfirmDialog() {
            if (window.Utils && Utils.showConfirmDialog) {
                try {
                    const result = await Utils.showConfirmDialog('测试确认', '您确定要继续吗？', '确定', '取消');
                    log(`确认对话框结果: ${result}`, result ? 'success' : 'info');
                } catch (error) {
                    log(`确认对话框错误: ${error.message}`, 'error');
                }
            } else {
                log('Utils.showConfirmDialog 不可用', 'error');
            }
        }

        async function testSelectDialog() {
            if (window.Utils && Utils.showSelectDialog) {
                try {
                    const options = ['选项1', '选项2', '选项3', '选项4'];
                    const result = await Utils.showSelectDialog('测试选择', options, '请选择一个选项:');
                    log(`选择对话框结果: ${result !== null ? `选择了 "${options[result]}" (索引 ${result})` : '取消'}`, 
                        result !== null ? 'success' : 'info');
                } catch (error) {
                    log(`选择对话框错误: ${error.message}`, 'error');
                }
            } else {
                log('Utils.showSelectDialog 不可用', 'error');
            }
        }

        // 页面加载完成后运行基础检查
        document.addEventListener('DOMContentLoaded', () => {
            log('测试页面已加载', 'info');
        });
    </script>

    <!-- 加载原有的脚本 -->
    <script src="src/js/utils.js"></script>
    <script src="src/js/storage.js"></script>
    <script src="src/js/playlist.js"></script>
    
    <script>
        // 等待脚本加载完成后运行测试
        setTimeout(() => {
            log('开始自动测试...', 'info');
            testModulesLoaded();
            testStorage();
        }, 1000);
    </script>
</body>
</html>